% Problem 18
close all; clc;
 
T = [-5.00,-4.80,-4.60,-4.40,-4.20,-4.00,-3.80,-3.60,-3.40,-3.20,-3.00,...
     -2.80,-2.60,-2.40,-2.20,-2.00,-1.80,-1.60,-1.40,-1.20,-1.00,-0.80,...
     -0.60,-0.40,-0.20,0.00,0.20,0.40,0.60,0.80,1.00,1.20,1.40,1.60,1.80,...
     2.00,2.20,2.40,2.60,2.80,3.00,3.20,3.40,3.60,3.80,4.00,4.20,4.40,...
     4.60,4.80,5.00,5.20,5.40,5.60,5.80,6.00,6.20,6.40,6.60,6.80,7.00];

Y = [170.03,182.38,133.57,145.42,151.57,105.10,123.68,29.38,130.37,32.38,...
     68.62,47.97,81.12,71.57,36.41,53.02,-13.34,-2.03,5.14,43.59,10.39,...
     -0.28,3.99,-2.33,1.32,10.79,13.49,-5.02,-21.35,43.63,-27.66,5.20,...
     -17.58,-3.28,5.03,81.28,95.88,44.65,68.23,97.04,22.50,133.24,133.86,...
     124.59,148.46,118.09,97.44,158.99,210.76,226.12,239.74,191.80,258.61,...
     253.79,286.63,281.53,354.26,358.41,371.70,389.25,377.95];
   
% changes here
tmp = (T>-3).*(T<3.5);
Y = Y.*(1-tmp) + 700*tmp;

ones = [];
ones(1, 1:length(T)) = 1;
 
F = vertcat(ones, T, T.^2);

theta = ((F * F')\F) * Y';
Yt = theta(1) + theta(2) * T + theta(3) * T.^2;
delta = sqrt(sum((Y - Yt).^2));
fprintf('Delta: %.2f\nVector theta: (%.2f, %.2f, %.2f)\n', delta, theta(1), theta(2), theta(3));
 
plot(T, Y, '+r');
hold on;
plot(T, Yt, 'b');
hold off;
axis tight; 
grid on;
